/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("ui.s2p.mm.purchorder.approve.util.Conversions");jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");sap.ca.scfld.md.controller.ScfldMasterController.extend("ui.s2p.mm.purchorder.approve.view.S2",{onInit:function(){this.getView().getModel().setSizeLimit(1000000);this.getData();this.bIsApproved=false;var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var C=sap.ui.component(c);C.oEventBus.subscribe("ui.s2p.mm.purchorder.approve","selectNextWorkItem",this._selectNextWorkItem,this);var l=this.getList();this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"){this.sItemBindingContextPath=this.getBindingContextPathFor(e.getParameter("arguments"));var n=l.getItems().length;var s=l.getSelectedItem();if(s!==null&&!sap.ui.Device.system.phone){var S=l.indexOfItem(s);this.aNextItems=[];var N=S+1;var i=S+2;this.aNextItems.push(s);if(n>=i){this.aNextItems.push(l.getItems()[N]);this.aNextItems.push(l.getItems()[i])}else if(n>=N){this.aNextItems.push(l.getItems()[N])}}}},this);l.attachEvent("updateFinished",function(e){if(!sap.ui.Device.system.phone){if(!this.aNextItems){var l=this.getList();var s=l.getSelectedItem();if(s!==null){var S=l.indexOfItem(s);var n=l.getItems().length;this.aNextItems=[];var N=S+1;var a=S+2;this.aNextItems.push(s);if(n>=a){this.aNextItems.push(l.getItems()[N]);this.aNextItems.push(l.getItems()[a])}else if(n>=N){this.aNextItems.push(l.getItems()[N])}}}else if(this.aNextItems&&this.getList().getItems().length>0){if(!this.findItemByContextPath(this.aNextItems[0].getBindingContextPath())){var f=false;for(var i in this.aNextItems){var I=this.findItemByContextPath(this.aNextItems[i].getBindingContextPath());if(I){this.setListItem(I);f=true;break}};if(!f){this.selectFirstItem()}}}else{this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE")}}},this);if(this.extHookOnInit){this.extHookOnInit()}},_selectNextWorkItem:function(c,e,d){if(e==="selectNextWorkItem"){if(sap.ui.Device.system.phone){window.history.go(-1)}var l=this.getList();l.getBinding('items').refresh();l.attachEventOnce("updateFinished",function(){if(d.bMessageToast&&d.bMessageToast===true&&d.sMessage){sap.m.MessageToast.show(d.sMessage,{duration:3500})}},this)}},getData:function(){var l=this.getList();var t=l.getItems()[0].clone();var s=new sap.ui.model.Sorter("WiCreatedAt",true);var f=[];l.bindItems("/WorkflowTaskCollection",t,s,f)},getHeaderFooterOptions:function(){var l={sI18NMasterTitle:"MASTER_TITLE"};if(this.extHookSetHeaderFooterOptions){l=this.extHookSetHeaderFooterOptions(l)}return l},_getODataSearchFields:function(){var o=["CreatedByName","ForwardedByName","ItemDescriptions","PoNumber","PoNumberFormatted","SearchForText","SubstitutingForName","SupplierID","SupplierName","WiCreatedAt","WorkitemID"];if(this.extHookModifySearchableODataFieldsForMasterListSearch){o=this.extHookModifySearchableODataFieldsForMasterListSearch(o)}return o},_getTextsFromUIElementsForSearch:function(i){var u=[];if(i.getIntro())u.push(i.getIntro());if(i.getTitle())u.push(i.getTitle());if(i.getNumber())u.push(i.getNumber());if(i.getNumberUnit())u.push(i.getNumberUnit());if(i.getFirstStatus())u.push(i.getFirstStatus().getText());if(i.getSecondStatus())u.push(i.getSecondStatus().getText());var a=i.getAttributes();for(var j=0;j<a.length;j++){u.push(a[j].getText())}if(this.extHookDefineSearchableUITextsForMasterListSearch){u=this.extHookDefineSearchableUITextsForMasterListSearch(i)}return u},_searchOnODataFields:function(i,f){var o=this._getODataSearchFields();var m=i.getBindingContext(this.sModelName).getProperty();for(var a=0;a<=o.length;a++){var k=o[a];var v="";if(k==="WiCreatedAt"){var M=m[k];var b=sap.ca.ui.model.format.DateFormat.getDateInstance({style:"medium"},sap.ui.getCore().getConfiguration().getLocale());if(M!==""){v=b.format(M,false)}}else{v=m[k]}if(typeof v==="string"){if(v.toLowerCase().indexOf(f)!==-1){return true}}}},_searchOnUITexts:function(i,f){var u=this._getTextsFromUIElementsForSearch(i);for(var a=0;a<=u.length;a++){if(typeof u[a]!=="undefined"&&u[a]!==""){if(u[a].toLowerCase().indexOf(f)!==-1){return true}}}},applySearchPatternToListItem:function(i,f){if(f===""){return true}if(this._searchOnODataFields(i,f)===true){return true}if(this._searchOnUITexts(i,f)===true){return true}return false}});
